<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Moderated Nonlinear Factor Analysis — mnlfa • mnlfa</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Moderated Nonlinear Factor Analysis — mnlfa"><meta property="og:description" content="General function for conducting moderated nonlinear factor analysis
(Curran et al., 2014). Item slopes and item intercepts can be modeled as functions
of person covariates.
Parameter regularization is allowed. For categorical covariates,
group lasso can be used for regularization."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mnlfa</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4</span
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/alexanderrobitzsch/mnlfa/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Moderated Nonlinear Factor Analysis</h1>
    
    <div class="hidden name"><code>mnlfa.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>General function for conducting moderated nonlinear factor analysis
(Curran et al., 2014). Item slopes and item intercepts can be modeled as functions
of person covariates.</p>
<p>Parameter regularization is allowed. For categorical covariates,
group lasso can be used for regularization.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mnlfa</span><span class="op">(</span><span class="va">dat</span>, <span class="va">items</span>, weights<span class="op">=</span><span class="cn">NULL</span>, item_type<span class="op">=</span><span class="st">"2PL"</span>, formula_int<span class="op">=</span><span class="op">~</span><span class="fl">1</span>, formula_slo<span class="op">=</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>   formula_res<span class="op">=</span><span class="op">~</span><span class="fl">0</span>, formula_mean<span class="op">=</span><span class="op">~</span><span class="fl">0</span>, formula_sd<span class="op">=</span><span class="op">~</span><span class="fl">0</span>, theta<span class="op">=</span><span class="cn">NULL</span>, parm_list_init<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>   parm_trait_init<span class="op">=</span><span class="cn">NULL</span>, prior_init<span class="op">=</span><span class="cn">NULL</span>, regular_lam<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, regular_alpha<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>   regular_type<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"none"</span>, <span class="st">"none"</span><span class="op">)</span>, maxit<span class="op">=</span><span class="fl">1000</span>, msteps<span class="op">=</span><span class="fl">4</span>, conv<span class="op">=</span><span class="fl">1e-05</span>,</span>
<span>   conv_mstep<span class="op">=</span><span class="fl">1e-04</span>, h<span class="op">=</span><span class="fl">1e-04</span>, parms_regular_types<span class="op">=</span><span class="cn">NULL</span>, parms_regular_lam<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>   parms_regular_alpha<span class="op">=</span><span class="cn">NULL</span>, parms_iterations<span class="op">=</span><span class="cn">NULL</span>, center_parms<span class="op">=</span><span class="cn">NULL</span>, center_max_iter<span class="op">=</span><span class="fl">6</span>,</span>
<span>   L_max<span class="op">=</span><span class="fl">.07</span>, verbose<span class="op">=</span><span class="cn">TRUE</span>, numdiff<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for mnlfa</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>, file<span class="op">=</span><span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>dat</dt>
<dd><p>Data frame with item responses</p></dd>

  <dt>items</dt>
<dd><p>Vector containing item names</p></dd>

<dt>weights</dt>
<dd><p>Optional vector of sampling weights for persons</p></dd>

  <dt>item_type</dt>
<dd><p>String or vector of item types. The item types <code>"1PL"</code> or
<code>"2PL"</code> for dichotomous items, <code>"GPCM"</code> for polytomous and <code>"NO"</code> for
continuous items can be chosen.</p></dd>

  <dt>formula_int</dt>
<dd><p>String or list with formula for item intercepts</p></dd>

  <dt>formula_slo</dt>
<dd><p>String or list with formula for item slopes</p></dd>

  <dt>formula_res</dt>
<dd><p>String or list with formula for logarithms of residual standard deviations</p></dd>

  <dt>formula_mean</dt>
<dd><p>Formula for mean of the trait distribution</p></dd>

  <dt>formula_sd</dt>
<dd><p>Formula for standard deviation of the trait distribution</p></dd>

  <dt>theta</dt>
<dd><p>Grid of \(\theta\) values used for approximation of normally
distributed trait</p></dd>

  <dt>parm_list_init</dt>
<dd><p>Optional list of initial item parameters</p></dd>

<dt>parm_trait_init</dt>
<dd><p>Optional list of initial parameters for trait distribution</p></dd>

<dt>prior_init</dt>
<dd><p>Optional matrix of prior distribution for persons</p></dd>

  <dt>regular_lam</dt>
<dd><p>Vector of length 2 or 3 (for <code>item_type="NO"</code>) containing regularization
parameters \(\lambda\) for item intercepts and item slopes</p></dd>

<dt>regular_alpha</dt>
<dd><p>Vector of length 2 or 3 containing \(\alpha\)
regularization parameter</p></dd>

  <dt>regular_type</dt>
<dd><p>Type of regularization method. Can be <code>"none"</code>,
<code>"lasso"</code>, <code>"scad"</code>, <code>"mcp"</code>, <code>"scadL2"</code>, <code>"ridge"</code> or
<code>"elnet"</code>.</p></dd>

  <dt>maxit</dt>
<dd><p>Maximum number of iterations</p></dd>

  <dt>msteps</dt>
<dd><p>Maximum number of M-steps</p></dd>

  <dt>conv</dt>
<dd><p>Convergence criterion with respect to parameters</p></dd>

  <dt>conv_mstep</dt>
<dd><p>Convergence criterion in M-step</p></dd>

  <dt>h</dt>
<dd><p>Numerical differentiation parameter</p></dd>

  <dt>parms_regular_types</dt>
<dd><p>Optional list containing parameter specific regularization types</p></dd>

  <dt>parms_regular_lam</dt>
<dd><p>Optional list containing parameter specific regularization parameters</p></dd>

  <dt>parms_regular_alpha</dt>
<dd><p>Optional list containing parameter specific regularization parameters</p></dd>

  <dt>parms_iterations</dt>
<dd><p>Optional list containing sequence of parameter indices used for updating</p></dd>

<dt>center_parms</dt>
<dd><p>Optional list indicating which parameters
should be centered during initial iterations.</p></dd>

<dt>center_max_iter</dt>
<dd><p>Maximum number of iterations in which parameters
  should be centered.</p></dd>

<dt>L_max</dt>
<dd><p>Majorization parameter used in regularization</p></dd>

<dt>verbose</dt>
<dd><p>Logical indicating whether output should be printed</p></dd>

<dt>numdiff</dt>
<dd><p>Logical indicating whether numerical differentiation
should be used</p></dd>

<dt>object</dt>
<dd><p>Object of class <code>mnlfa</code></p></dd>

<dt>file</dt>
<dd><p>Optional file name</p></dd>

<dt>...</dt>
<dd><p>Further arguments to be passed</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The moderated factor analysis model for dichotomous responses defined as
$$P(X_{pi}=1 | \theta_p )=invlogit( a_{pi} \theta_p - b_{pi} ) $$
The trait distribution \(\theta_p \sim N( \mu_p, \sigma_p^2)\)
allows a latent regression of person covariates on the mean
with \(\mu_p=\bold{X}_p \bold{\gamma}\) (to be specified in <code>formula_mean</code>)
and the logarithm of the standard deviation \(\log \sigma_p=\bold{Z}_p \bold{\delta} \)
(to be specified in <code>formula_sd</code>).
Item intercepts and item slopes can be moderated by person covariates, i.e.
\(a_{pi}=\bold{W}_{pi} \bold{\alpha}_i \) and
\(b_{pi}=\bold{V}_{pi} \bold{\beta}_i \). Regularization on (some of) the
\(\bold{\alpha}_i\) or \(\bold{\beta}_i\) parameters is allowed.</p>
<p>For polytomous item responses, the generalized partial credit model is parametrized
as $$P(X_{pi}=k | \theta_p \propto \exp ( k a_{pi} \theta_p - k b_{pi} - b_{k} $$
with \(b_0=0\).</p>
<p>For normally distributed responses, the conditional distribution of item responses
is defined as $$ X_{pi} | \theta_p \sim \mathrm{N} ( b_{pi} + a_{pi} \theta_p,
\psi_{pi}^2 ) $$ Note that \(\log \psi_{pi}\) is modeled in this function.</p>
<p>The model is estimated using an EM algorithm with the coordinate descent
method during the M-step (Sun et al., 2016).</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>List with model results including</p>
<dl><dt>item</dt>
<dd><p>Summary table for item parameters</p></dd>

<dt>trait</dt>
<dd><p>Summary table for trait parameters</p></dd>

</dl></div>
    <div id="references">
    <h2>References</h2>
    <p>Curran, P. J., McGinley, J. S., Bauer, D. J., Hussong, A. M., Burns, A.,
Chassin, L., Sher, K., &amp; Zucker, R. (2014).
A moderated nonlinear factor model for the development of commensurate measures
in integrative data analysis. <em>Multivariate Behavioral Research, 49</em>(3),
214-231.
http://dx.doi.org/10.1080/00273171.2014.889594</p>
<p>Sun, J., Chen, Y., Liu, J., Ying, Z., &amp; Xin, T. (2016). Latent variable selection for
multidimensional item response theory models via L1 regularization.
<em>Psychometrika, 81</em>(4), 921-939.
 https://doi.org/10.1007/s11336-016-9529-6</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>See also the <span class="pkg">aMNLFA</span> package for automatized moderated nonlinear factor analysis
which provides convenient wrapper functions for automized analysis
in the <em>Mplus</em> software.</p>
<p>See the <span class="pkg">GPCMlasso</span> package for the regularized generalized partial credit model.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co">#############################################################################</span></span>
<span><span class="co"># EXAMPLE 1: Dichotomous data, 1PL model</span></span>
<span><span class="co">#############################################################################</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data.mnlfa01</span>, package<span class="op">=</span><span class="st">"mnlfa"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">data.mnlfa01</span></span>
<span><span class="co"># extract items from dataset</span></span>
<span><span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"I[0-9]"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, value<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">items</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># maximum number of iterations (use only few iterations for the only purpose of</span></span>
<span><span class="co"># providing CRAN checks)</span></span>
<span><span class="va">maxit</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co">#***** Model 1: 1PL model without moderating parameters and without covariates for traits</span></span>
<span></span>
<span><span class="co"># no covariates for trait</span></span>
<span><span class="va">formula_mean</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">0</span></span>
<span><span class="va">formula_sd</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span></span>
<span><span class="co"># no item covariates</span></span>
<span><span class="va">formula_int</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span></span>
<span><span class="va">formula_slo</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span></span>
<span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">mnlfa</span><span class="fu">::</span><span class="fu">mnlfa</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, <span class="va">items</span>, item_type<span class="op">=</span><span class="st">"1PL"</span>, formula_int<span class="op">=</span><span class="va">formula_int</span>,</span>
<span>             formula_slo<span class="op">=</span><span class="va">formula_slo</span>, formula_mean<span class="op">=</span><span class="va">formula_mean</span>, formula_sd<span class="op">=</span><span class="va">formula_sd</span>,</span>
<span>             maxit<span class="op">=</span><span class="va">maxit</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># \donttest{</span></span>
<span><span class="co">#***** Model 2: 1PL model without moderating parameters and with covariates for traits</span></span>
<span></span>
<span><span class="co"># covariates for trait</span></span>
<span><span class="va">formula_mean</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">female</span> <span class="op">+</span> <span class="va">age</span></span>
<span><span class="va">formula_sd</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span></span>
<span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu">mnlfa</span><span class="fu">::</span><span class="fu">mnlfa</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, <span class="va">items</span>, item_type<span class="op">=</span><span class="st">"1PL"</span>, formula_int<span class="op">=</span><span class="va">formula_int</span>,</span>
<span>             formula_slo<span class="op">=</span><span class="va">formula_slo</span>, formula_mean<span class="op">=</span><span class="va">formula_mean</span>, formula_sd<span class="op">=</span><span class="va">formula_sd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#***** Model 3: 1PL model with moderating parameters and with covariates for traits</span></span>
<span><span class="co">#***   Regularization method 'mcp'</span></span>
<span></span>
<span><span class="co"># covariates for trait</span></span>
<span><span class="va">formula_mean</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">female</span> <span class="op">+</span> <span class="va">age</span></span>
<span><span class="va">formula_sd</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span></span>
<span><span class="co"># moderation effects for items</span></span>
<span><span class="va">formula_int</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span><span class="op">+</span><span class="va">female</span><span class="op">+</span><span class="va">age</span></span>
<span><span class="va">formula_slo</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span></span>
<span></span>
<span><span class="co"># center parameters for female and age in initial iterations for improving convergence</span></span>
<span><span class="va">center_parms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>,<span class="va">I</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>,<span class="va">I</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># regularization parameters for item intercept and item slope, respectively</span></span>
<span><span class="va">regular_lam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.06</span>, <span class="fl">.25</span><span class="op">)</span></span>
<span><span class="va">regular_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcp"</span>,<span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu">mnlfa</span><span class="fu">::</span><span class="fu">mnlfa</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, <span class="va">items</span>, item_type<span class="op">=</span><span class="st">"1PL"</span>, formula_int<span class="op">=</span><span class="va">formula_int</span>,</span>
<span>            formula_slo<span class="op">=</span><span class="va">formula_slo</span>, formula_mean<span class="op">=</span><span class="va">formula_mean</span>, formula_sd<span class="op">=</span><span class="va">formula_sd</span>,</span>
<span>            center_parms<span class="op">=</span><span class="va">center_parms</span>, regular_lam<span class="op">=</span><span class="va">regular_lam</span>, regular_type<span class="op">=</span><span class="va">regular_type</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># update Model 3 with initial parameters</span></span>
<span><span class="va">parm_trait_init</span> <span class="op">&lt;-</span> <span class="va">mod3</span><span class="op">$</span><span class="va">parm_trait</span></span>
<span><span class="va">parm_list_init</span> <span class="op">&lt;-</span> <span class="va">mod3</span><span class="op">$</span><span class="va">parm_list</span></span>
<span><span class="va">prior_init</span> <span class="op">&lt;-</span> <span class="va">mod3</span><span class="op">$</span><span class="va">prior</span></span>
<span><span class="va">mod3b</span> <span class="op">&lt;-</span> <span class="fu">mnlfa</span><span class="fu">::</span><span class="fu">mnlfa</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, <span class="va">items</span>, item_type<span class="op">=</span><span class="st">"1PL"</span>, formula_int<span class="op">=</span><span class="va">formula_int</span>,</span>
<span>            formula_slo<span class="op">=</span><span class="va">formula_slo</span>, formula_mean<span class="op">=</span><span class="va">formula_mean</span>, formula_sd<span class="op">=</span><span class="va">formula_sd</span>,</span>
<span>            center_parms<span class="op">=</span><span class="va">center_parms</span>, regular_lam<span class="op">=</span><span class="va">regular_lam</span>,</span>
<span>            regular_type<span class="op">=</span><span class="va">regular_type</span>, parm_trait_init<span class="op">=</span><span class="va">parm_trait_init</span>,</span>
<span>            parm_list_init<span class="op">=</span><span class="va">parm_list_init</span>, prior_init<span class="op">=</span><span class="va">prior_init</span>,  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod3b</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#***** Model 4: 1PL model with selected moderated item parameters</span></span>
<span></span>
<span><span class="co">#* trait distribution</span></span>
<span><span class="va">formula_mean</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">0</span><span class="op">+</span><span class="va">female</span><span class="op">+</span><span class="va">age</span></span>
<span><span class="va">formula_sd</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span></span>
<span></span>
<span><span class="co">#* formulas for item intercepts</span></span>
<span><span class="va">formula_int</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span></span>
<span><span class="va">formula_int</span> <span class="op">&lt;-</span> <span class="fu">mnlfa</span><span class="fu">::</span><span class="fu"><a href="mnlfa_expand_to_list.html">mnlfa_expand_to_list</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">formula_int</span>, names_list<span class="op">=</span><span class="va">items</span><span class="op">)</span></span>
<span><span class="va">mod_items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">ii</span> <span class="kw">in</span> <span class="va">mod_items</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">formula_int</span><span class="op">[[</span><span class="va">ii</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span><span class="op">+</span><span class="va">female</span><span class="op">+</span><span class="va">age</span></span>
<span><span class="op">}</span></span>
<span><span class="va">formula_slo</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span></span>
<span></span>
<span><span class="va">mod4</span> <span class="op">&lt;-</span> <span class="fu">mnlfa</span><span class="fu">::</span><span class="fu">mnlfa</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, <span class="va">items</span>, item_type<span class="op">=</span><span class="st">"1PL"</span>, formula_int<span class="op">=</span><span class="va">formula_int</span>,</span>
<span>              formula_slo<span class="op">=</span><span class="va">formula_slo</span>, formula_mean<span class="op">=</span><span class="va">formula_mean</span>, formula_sd<span class="op">=</span><span class="va">formula_sd</span><span class="op">)</span></span>
<span><span class="va">mod4</span><span class="op">$</span><span class="va">item</span></span>
<span><span class="va">mod4</span><span class="op">$</span><span class="va">trait</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod4</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#############################################################################</span></span>
<span><span class="co"># EXAMPLE 2: Continuous items</span></span>
<span><span class="co">#############################################################################</span></span>
<span></span>
<span><span class="co">#-- simulate data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">78</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean<span class="op">=</span><span class="fl">0.3</span><span class="op">*</span><span class="va">z</span> <span class="op">-</span> <span class="fl">.1</span><span class="op">*</span><span class="va">z</span><span class="op">^</span><span class="fl">2</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.5</span><span class="op">+</span><span class="fl">.3</span><span class="op">*</span><span class="va">z</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">N</span>, ncol<span class="op">=</span><span class="va">I</span><span class="op">)</span></span>
<span><span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"I"</span>,<span class="fl">1</span><span class="op">:</span><span class="va">I</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">z</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">ii</span> <span class="kw">in</span> <span class="fl">1L</span><span class="op">:</span><span class="va">I</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">f</span> <span class="op">&lt;-</span> <span class="fl">0.4</span><span class="op">*</span><span class="op">(</span><span class="va">ii</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">dat</span><span class="op">[</span>,<span class="va">ii</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">.6</span><span class="op">+</span><span class="op">-</span><span class="va">f</span><span class="op">*</span><span class="va">z</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">f</span><span class="op">*</span><span class="va">z</span><span class="op">)</span><span class="op">*</span><span class="va">theta</span> <span class="op">+</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.3</span><span class="op">)</span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#--- estimate model</span></span>
<span><span class="va">formula_mean</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">z</span></span>
<span><span class="va">formula_sd</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">z</span></span>
<span><span class="va">formula_int</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span><span class="op">+</span><span class="va">z</span></span>
<span><span class="va">formula_slo</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span><span class="op">+</span><span class="va">z</span></span>
<span><span class="va">formula_res</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span><span class="op">+</span><span class="va">z</span></span>
<span></span>
<span><span class="va">regular_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcp"</span>,<span class="st">"mcp"</span>,<span class="st">"mcp"</span><span class="op">)</span></span>
<span><span class="va">regular_lam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1e-3</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">maxit</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">item_type</span> <span class="op">&lt;-</span> <span class="st">"NO"</span></span>
<span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">mnlfa</span><span class="fu">::</span><span class="fu">mnlfa</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, <span class="va">items</span>, item_type<span class="op">=</span><span class="va">item_type</span>, formula_int<span class="op">=</span><span class="va">formula_int</span>,</span>
<span>             formula_slo<span class="op">=</span><span class="va">formula_slo</span>, formula_res<span class="op">=</span><span class="va">formula_res</span>, formula_mean<span class="op">=</span><span class="va">formula_mean</span>,</span>
<span>             formula_sd<span class="op">=</span><span class="va">formula_sd</span>, maxit<span class="op">=</span><span class="va">maxit</span>, regular_type<span class="op">=</span><span class="va">regular_type</span>, h<span class="op">=</span><span class="fl">1e-4</span>,</span>
<span>             regular_lam<span class="op">=</span><span class="va">regular_lam</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#############################################################################</span></span>
<span><span class="co"># EXAMPLE 3: Polytomous items</span></span>
<span><span class="co">#############################################################################</span></span>
<span></span>
<span><span class="co">#--- simulate data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">78</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean<span class="op">=</span><span class="fl">0.3</span><span class="op">*</span><span class="va">z</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.3</span><span class="op">*</span><span class="va">z</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">N</span>, ncol<span class="op">=</span><span class="va">I</span><span class="op">)</span></span>
<span><span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"I"</span>,<span class="fl">1</span><span class="op">:</span><span class="va">I</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">z</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">ii</span> <span class="kw">in</span> <span class="fl">1L</span><span class="op">:</span><span class="va">I</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">f</span> <span class="op">&lt;-</span> <span class="fl">0.4</span><span class="op">*</span><span class="op">(</span><span class="va">ii</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span> <span class="op">)</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">f</span><span class="op">*</span><span class="va">z</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">f</span><span class="op">*</span><span class="va">z</span><span class="op">)</span><span class="op">*</span><span class="va">theta</span> <span class="op">+</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.3</span><span class="op">)</span>  <span class="op">)</span></span>
<span>    <span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">ii</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span><span class="op">==</span><span class="fl">0</span> <span class="op">)</span></span>
<span>    <span class="va">br</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span>, len<span class="op">=</span><span class="va">K</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span> <span class="op">+</span> <span class="va">ii</span> <span class="op">/</span> <span class="va">I</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span> <span class="va">y</span>, breaks<span class="op">=</span><span class="va">br</span><span class="op">)</span> <span class="op">)</span><span class="op">-</span><span class="fl">1</span></span>
<span>    <span class="va">dat</span><span class="op">[</span>,<span class="va">ii</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">y</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#--- estimate model</span></span>
<span><span class="va">formula_mean</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span> <span class="op">+</span> <span class="va">z</span></span>
<span><span class="va">formula_sd</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span> <span class="op">+</span> <span class="va">z</span></span>
<span><span class="va">formula_int</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span><span class="op">+</span><span class="va">z</span></span>
<span><span class="va">formula_slo</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span><span class="op">+</span><span class="va">z</span></span>
<span></span>
<span><span class="va">regular_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"scadL2"</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">regular_lam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.02</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">regular_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">maxit</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">item_type</span> <span class="op">&lt;-</span> <span class="st">"GPCM"</span></span>
<span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">mnlfa</span><span class="fu">::</span><span class="fu">mnlfa</span><span class="op">(</span> dat<span class="op">=</span><span class="va">dat</span>, <span class="va">items</span>, item_type<span class="op">=</span><span class="va">item_type</span>, formula_int<span class="op">=</span><span class="va">formula_int</span>,</span>
<span>             formula_slo<span class="op">=</span><span class="va">formula_slo</span>, formula_mean<span class="op">=</span><span class="va">formula_mean</span>,</span>
<span>             formula_sd<span class="op">=</span><span class="va">formula_sd</span>, maxit<span class="op">=</span><span class="va">maxit</span>, regular_type<span class="op">=</span><span class="va">regular_type</span>, h<span class="op">=</span><span class="fl">1e-4</span>,</span>
<span>             regular_lam<span class="op">=</span><span class="va">regular_lam</span>, regular_alpha<span class="op">=</span><span class="va">regular_alpha</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span><span class="co"># }</span></span></code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Alexander Robitzsch.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

